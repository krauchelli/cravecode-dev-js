<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keranjang</title>
    <link rel="stylesheet" href="styles/style-shop.css">
</head>

<body>
    <header id="home">
        <%- include("partials/sidebar") %>
    </header>

    <%- include("partials/section-nav") %>

    <section class="keranjang">
        <!-- dengan logika templating -->
        <div class="items">
        <% cart.items.forEach(item => { %>
            <div class="item">
                <img src="<%= item.product.imagePath %>" alt="produk-keranjang">
                <div class="details">
                    <span class="item-id"><%= item.id %></span>
                    <span class="item-name"><%= item.product.name %></span>
                    <span class="item-price">Rp<%= item.product.price %></span>
                </div>
                <div class="quantity">
                    <button class="minus">-</button>
                    <a><%= item.quantity %></a>
                    <button class="plus">+</button>
                </div>
            </div>
        <% }); %>
        </div>

        <div class="order-summary">
            <h2>Order Summary</h2>
            <div class="summary-details">
                <div class="subtotal">
                    <span>Subtotal</span>
                    <span><%= subtotal %></span>
                </div>
                <form method="POST" action="/add-to-process">
                    <div class="shipping">
                        <span>Pilih Pengiriman</span>
                        <select>
                            <option value="gopay">SELECT</option>
                            <option value="gosend">GO-SEND</option>
                            <option value="jne">JNE</option>
                            <option value="jnt">JNT</option>
                            <option value="sicepat">SICEPAT</option>
                            <option value="wahana">WAHANA</option>
                        </select>
                    </div>
                    <div class="payment-method">
                        <span>Metode Pembayaran</span>
                        <select name="paymentMethod">
                            <option value="">SELECT</option>
                            <option value="method1">GO-PAY</option>
                            <option value="method2">DANA</option>
                            <option value="method3">OVO</option>
                            <option value="method4">LINKAJA</option>
                            <option value="method5">SHOPEEPAY</option>
                            <option value="method6">BANK TRANSFER</option>
                        </select>
                    </div>
                    <div class="total">
                        <span>Total</span>
                        <!-- nanda -->
                        <span>Rp<%= subtotal %></span>
                    </div>
                </div>
                <button class="checkout" onclick="ShowQR()">CHECKOUT</button>
                <!-- nanda mau checkout tapi customer belum loin-->
                <button class="checkout2">CHECKOUT</button>
            </form>
        </div>
    </section>

    <div class="popup-qr" id="qr-popup">
        <div class="popup-content-qr">
            <span class="close" onclick="closeQR()">&times;</span>
            <h2>Scan QR untuk Bayar</h2>
            <img src="images/QR.png" alt="QR" class="icon">
        </div>
    </div>


    <%- include("partials/footer") %>


    <script src="scripts/scripts.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    $(document).ready(function() {
        $('.plus').click(function() {
            var cartId = $(this).parent().siblings('.details').find('.item-id').text();
            var quantity = parseInt($(this).siblings('a').text()) + 1;
            $(this).siblings('a').text(quantity);

            $.ajax({
                url: '/shop',
                type: 'PUT',
                data: {
                    cartId: cartId,
                    quantity: quantity
                },
                success: function(response) {
                    console.log(response);
                },
                error: function(error) {
                    console.log(error);
                }
            });
        });

        $('.minus').click(function() {
            var cartId = $(this).parent().siblings('.details').find('.item-id').text();
            var quantity = parseInt($(this).siblings('a').text()) - 1;
            if (quantity < 0) quantity = 0;
            $(this).siblings('a').text(quantity);

            $.ajax({
                url: '/shop',
                type: 'PUT',
                data: {
                    cartId: cartId,
                    quantity: quantity
                },
                success: function(response) {
                    console.log(response);
                },
                error: function(error) {
                    console.log(error);
                }
            });
        });
    });
    </script>
</body>

</html>